{"version":3,"file":"index.umd.js","sources":["../src/index.js"],"sourcesContent":["// Defaults\r\nconst defaultOptions = {\r\n\tformat: 'image/png',\r\n\tquality: 0.92,\r\n\twidth: undefined,\r\n\theight: undefined,\r\n\tCanvas: undefined,\r\n\tcrossOrigin: undefined,\r\n};\r\n\r\nconst getX = (image, width) => {\r\n\tif (image.right != undefined)\r\n\t\treturn width - (image.right + (image.width || image.img.width));\r\n\treturn image.left || image.x || 0;\r\n}\r\n\r\nconst getY = (image, height) => {\r\n\tif (image.bottom != undefined)\r\n\t\treturn height - (image.bottom + (image.height || image.img.height));\r\n\treturn image.top || image.y || 0;\r\n}\r\n\r\n// Return Promise\r\nconst mergeImages = (sources = [], options = {}) => new Promise(resolve => {\r\n\toptions = Object.assign({}, defaultOptions, options);\r\n\r\n\t// Setup browser/Node.js specific variables\r\n\tconst canvas = options.Canvas ? new options.Canvas() : window.document.createElement('canvas');\r\n\tconst Image = options.Image || window.Image;\r\n\r\n\t// Load sources\r\n\tconst images = sources.map(source => new Promise((resolve, reject) => {\r\n\t\t// Convert sources to objects\r\n\t\tif (source.constructor.name !== 'Object') {\r\n\t\t\tsource = { src: source };\r\n\t\t}\r\n\r\n\t\t// Resolve source and img when loaded\r\n\t\tconst img = new Image();\r\n\t\timg.crossOrigin = options.crossOrigin;\r\n\t\timg.onerror = () => reject(new Error(`Couldn\\'t load image: ${img.src || 'unknown source'}`));\r\n\t\timg.onload = () => resolve(Object.assign({}, source, { img }));\r\n\t\timg.src = source.src;\r\n\t\timg.custom = source.custom;\r\n\t}));\r\n\r\n\t// Get canvas context\r\n\tconst ctx = canvas.getContext('2d');\r\n\r\n\t// When sources have loaded\r\n\tresolve(Promise.all(images)\r\n\t\t.then(images => {\r\n\t\t\t// Set canvas dimensions\r\n\t\t\tconst getSize = dim => options[dim] || Math.max(...images.map(image => image.img[dim]));\r\n\t\t\tcanvas.width = getSize('width');\r\n\t\t\tcanvas.height = getSize('height');\r\n\r\n\t\t\t// Draw images to canvas\r\n\t\t\timages.forEach(image => {\r\n\t\t\t\t// Local canvas\r\n\t\t\t\tconst _canvas = options.Canvas ? new options.Canvas() : window.document.createElement('canvas');\r\n\t\t\t\t_canvas.width = image.width || image.img.width;\r\n\t\t\t\t_canvas.height = image.height || image.img.height;\r\n\r\n\t\t\t\t// Local context\r\n\t\t\t\tconst _ctx = _canvas.getContext('2d');\r\n\t\t\t\t_ctx.globalAlpha = image.opacity || 1;\r\n\r\n\t\t\t\t// Check if any custom filtering\r\n\t\t\t\tif (image.custom) image.custom(_ctx, image);\r\n\r\n\t\t\t\t// Draw the image locally\r\n\t\t\t\t_ctx.drawImage(image.img, 0, 0, image.width || image.img.width, image.height || image.img.height);\r\n\r\n\t\t\t\t// Add image to main canvas\r\n\t\t\t\tctx.drawImage(_ctx.canvas, getX(image, canvas.width), getY(image, canvas.height), image.width || image.img.width, image.height || image.img.height);\r\n\t\t\t});\r\n\r\n\t\t\tif (options.Canvas && options.format === 'image/jpeg') {\r\n\t\t\t\t// Resolve data URI for node-canvas jpeg async\r\n\t\t\t\treturn new Promise((resolve, reject) => {\r\n\t\t\t\t\tcanvas.toDataURL(options.format, {\r\n\t\t\t\t\t\tquality: options.quality,\r\n\t\t\t\t\t\tprogressive: false\r\n\t\t\t\t\t}, (err, jpeg) => {\r\n\t\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\t\treject(err);\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tresolve(jpeg);\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\t// Resolve all other data URIs sync\r\n\t\t\treturn canvas.toDataURL(options.format, options.quality);\r\n\t\t}));\r\n});\r\n\r\nexport default mergeImages;\r\n"],"names":["const"],"mappings":"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"}